<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTube Studio Manager</title>
    <!-- Add any additional CSS or JS links here if needed -->
</head>

<body>
    <div class="container">
        <h1>VTube Studio Manager</h1>
        <h2>Models</h2>
        <div class="models-container">

        </div>
        <h2>Expressions</h2>
        <div class="expressions-container">

        </div>

    </div>

    <!-- Add any additional HTML content or scripts here if needed -->
    <script>
        // pass the model id to post vts/api/loadModel when a model button is clicked
        const modelButtons = document.querySelectorAll('.model-button');
        modelButtons.forEach(button => {
            button.addEventListener('click', () => {
                const Model_ID = button.getAttribute('modelid');

                // Create form data
                const formData = new URLSearchParams();
                formData.append('Model_ID', Model_ID);

                fetch('/vts/api/loadModel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            console.log('Model loaded successfully');
                        } else {
                            console.log('Model failed to load, error: ' + data.error);
                        }
                    })
                    .catch(error => {
                        // do something
                    });
            });
        });
        const expressionButtons = document.querySelectorAll('.expression-button');
        // send file and active state true of false you want to send as "file" and "active" in the form data
        expressionButtons.forEach(button => {
            button.addEventListener('click', () => {
                const Expression_File = button.getAttribute('expressionfile');
                const Expression_Active = button.getAttribute('style');
                // Create form data
                const formData = new URLSearchParams();
                formData.append('Expression_File', Expression_File);
                formData.append('Expression_Active', Expression_Active);

                fetch('/vts/api/setExpression', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            console.log('Expression loaded successfully');
                        } else {
                            console.log('Expression failed to load, error: ' + data.error);
                        }
                    })
                    .catch(error => {
                        // do something
                    });
            });
        });
        var models = [];
        var expressions = [];
        // get json in route /vts/api/models and /vts/api/expressions every half a second and use it to populate the buttons

        function getModels() {
            fetch('/vts/api/models', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        models = data.models;
                    } else {
                        console.log('Failed to get models, error: ' + data.error);
                    }
                })
                .catch(error => {
                    // do something
                });
        }
        function getExpressions() {
            fetch('/vts/api/expressions', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        expressions = data.expressions;
                    } else {
                        console.log('Failed to get expressions, error: ' + data.error);
                    }
                })
                .catch(error => {
                    // do something
                });
        }
        function populateModels() {
            const modelsContainer = document.querySelector('.models-container');
            modelsContainer.innerHTML = '';
            models.forEach(model => {
                const modelButton = document.createElement('button');
                modelButton.classList.add('model-button');
                modelButton.setAttribute('modelId', model.id);
                if (model.active) {
                    modelButton.style.backgroundColor = 'green';
                }
                modelButton.innerHTML = model.name;
                modelsContainer.appendChild(modelButton);

                // Set up the event listener for this button
                modelButton.addEventListener('click', () => {
                    const Model_ID = modelButton.getAttribute('modelId');

                    // Create form data
                    const formData = new URLSearchParams();
                    formData.append('Model_ID', Model_ID);

                    fetch('/vts/api/loadModel', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: formData
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                console.log('Model loaded successfully');
                            } else {
                                console.log('Model failed to load, error: ' + data.error);
                            }
                        })
                        .catch(error => {
                            // do something
                        });
                });
            });
        }

        function populateExpressions() {
            const expressionsContainer = document.querySelector('.expressions-container');
            expressionsContainer.innerHTML = '';
            expressions.forEach(expression => {
                const expressionButton = document.createElement('button');
                expressionButton.classList.add('expression-button');
                expressionButton.setAttribute('expressionfile', expression.file);
                if (expression.active) {
                    expressionButton.style.backgroundColor = 'green';
                }
                expressionButton.innerHTML = expression.name;
                expressionsContainer.appendChild(expressionButton);

                // Set up the event listener for this button
                expressionButton.addEventListener('click', () => {
                    const Expression_File = expressionButton.getAttribute('expressionfile');
                    const Expression_Active = expressionButton.getAttribute('style');

                    // Create form data
                    const formData = new URLSearchParams();
                    formData.append('Expression_File', Expression_File);
                    formData.append('Expression_Active', Expression_Active);

                    fetch('/vts/api/setExpression', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: formData
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                console.log('Expression loaded successfully');
                            } else {
                                console.log('Expression failed to load, error: ' + data.error);
                            }
                        })
                        .catch(error => {
                            // do something
                        });
                });
            });
        }

        function populate() {
            populateModels();
            populateExpressions();
        }
        function update() {
            getModels();
            getExpressions();
            populate();
        }
        update();
        setInterval(update, 3000);






    </script>
</body>

</html>
<!--
    example of what the html should look like after the script runs
    <div class="models-container"><button class="model-button" modelid="986f6c763e1148a8b625994f2e6ae077">Akari</button><button class="model-button" modelid="f8f32cf5b0aa4f8a890e8fb7f98ff77b">Avatar1</button><button class="model-button" modelid="7d08b8b073ae428d8446009dbd0727eb" style="background-color: green;">Big iz</button><button class="model-button" modelid="57ac6bef91f146029aae3a2ee6d03f51">Hijiki</button><button class="model-button" modelid="e8c7f93929834f2096a88f48150fa1eb">Hiyori_A</button><button class="model-button" modelid="a679f8f8ab7d434882b31565e9f38f17">iz 2.0</button><button class="model-button" modelid="84ee96d4c7cc4b09ab0097d54a1b5210">iz 3.0</button><button class="model-button" modelid="3cb3663badab469089f70b4dc05d7048">izitto</button><button class="model-button" modelid="370b78347f9248d29f719bed9b659130">small iz</button><button class="model-button" modelid="2d9af98a95c647c4b13bb1b1947d4d14">Tororo</button><button class="model-button" modelid="287790a39b814476912afd2d20565bef">Wanko</button></div>
    
-->